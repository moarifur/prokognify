# Complete Clerk Authentication Workflow for Next.js (JavaScript)

This guide provides a step-by-step workflow to implement Clerk authentication in a Next.js application using JavaScript. The workflow includes installation, setup, route protection, and custom sign-in/sign-up pages.

## 1. Installation and Initial Setup

### Install Clerk SDK

```bash
npm install @clerk/nextjs
```

### Set Environment Variables

Create or update your `.env` file:

```env
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_Z2xvcmlvdXMtcXVhZ2dhLTk1LmNsZXJrLmFjY291bnRzLmRldiQ
CLERK_SECRET_KEY=sk_test_jJd6anSQ27pVNBjDjYWbzMnhOQz4tvNaKRP3cRQ8fr
```

## 2. Basic Middleware Setup

Create `middleware.js` in your root or src directory:

```javascript
import { clerkMiddleware } from '@clerk/nextjs/server';

export default clerkMiddleware();

export const config = {
  matcher: [
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
};
```

## 3. Root Layout Setup

Update your `layout.js`:

```javascript
import { ClerkProvider, SignedIn, SignedOut, SignInButton, SignUpButton, UserButton } from "@clerk/nextjs";
import { ThemeProvider } from "@/components/theme-provider";
import { Button } from "@/components/ui/button";
import "./globals.css";

export const metadata = {
  title: "ProKognify",
  description: "Build & Launch a Fullstack LMS Platform",
};

const RootLayout = ({ children }) => {
  return (
    <html lang="en" suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          <ClerkProvider>
            <header className="flex justify-end items-center p-4 gap-4 h-16">
              <SignedOut>
                <SignInButton />
                <SignUpButton>
                  <Button variant="default" className="text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5">
                    Sign Up
                  </Button>
                </SignUpButton>
              </SignedOut>
              <SignedIn>
                <UserButton />
              </SignedIn>
            </header>
            {children}
          </ClerkProvider>
        </ThemeProvider>
      </body>
    </html>
  );
};

export default RootLayout;
```

## 4. Advanced Route Protection

Update your middleware to protect specific routes:

```javascript
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server';

const isPublicRoute = createRouteMatcher([
  '/sign-in(.*)',
  '/sign-up(.*)',
  '/', // Homepage
  '/api/webhooks(.*)', // Webhook routes should be public
]);

const isProtectedRoute = createRouteMatcher([
  '/teacher(.*)',
  '/api/courses(.*)', // Protect course API routes
]);

const middleware = clerkMiddleware(async (auth, req) => {
  // Protect specific routes that require authentication
  if (isProtectedRoute(req)) {
    await auth.protect();
  }

  // For API routes, ensure user is authenticated
  if (req.nextUrl.pathname.startsWith('/api/courses')) {
    await auth.protect();
  }
});

export default middleware;

export const config = {
  matcher: [
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
};
```

## 5. Custom Authentication Pages

### Sign-In Page

Create `src/app/(auth)/(routes)/sign-in/[[...sign-in]]/page.jsx`:

```javascript
import { SignIn } from '@clerk/nextjs'

const SignInPage = () => (
  <div className="min-h-screen flex items-center justify-center">
    <SignIn />
  </div>
)

export default SignInPage;
```

### Sign-Up Page

Create `src/app/(auth)/(routes)/sign-up/[[...sign-up]]/page.jsx`:

```javascript
import { SignUp } from '@clerk/nextjs'

const SignUpPage = () => (
  <div className="min-h-screen flex items-center justify-center">
    <SignUp />
  </div>
)

export default SignUpPage;
```

## 6. Simplified Root Layout for Auth Pages

Update your root layout to remove the header when on auth pages:

```javascript
import { ClerkProvider } from "@clerk/nextjs";
import { ThemeProvider } from "@/components/theme-provider";
import "./globals.css";

export const metadata = {
  title: "ProKognify",
  description: "Build & Launch a Fullstack LMS Platform",
};

const RootLayout = ({ children }) => {
  return (
    <html lang="en" suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          <ClerkProvider>
            {children}
          </ClerkProvider>
        </ThemeProvider>
      </body>
    </html>
  );
};

export default RootLayout;
```

## 7. Testing the Implementation

1. Run your development server:

```bash
npm run dev
```

2. Visit `http://localhost:3000` to see your application

3. Test the sign-up and sign-in flows

4. Verify protected routes (like `/teacher`) require authentication

## 8. Next Steps

- Customize the appearance of Clerk components using themes
- Add user profile management
- Implement role-based access control
- Set up webhooks for user events
- Add social login providers

---

This complete workflow provides a robust authentication system with protected routes, custom auth pages, and a clean user interface. The implementation follows best practices for Next.js applications while keeping the code JavaScript-only as requested.